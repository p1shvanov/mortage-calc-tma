import{j as e,I as t,g as a,C as n,h as r,k as s,l,m as i,B as o,o as m}from"./vendor-telegram-DYpFzjZD.js";import{a as d,u}from"./vendor-react-BsEvrc09.js";import{u as c,a as h}from"./index-BpHproDs.js";import{u as y,x as p,z as g,c as f,f as x,a as j}from"./vendor-forms-B2qA07-X.js";import{P as b}from"./Page-D19Mk31s.js";const P=d.forwardRef(((r,s)=>{const{field:l,...i}=r,{isTouched:o,errors:m,isValidating:d}=l.state.meta;return e.jsxs(e.Fragment,{children:[e.jsx(t,{...i,ref:s,id:l.name,name:l.name,value:l.state.value,onBlur:l.handleBlur,onChange:e=>l.handleChange(e.target.value),status:m.length?"error":"default",after:d?e.jsx(a,{size:"s"}):i.after}),o&&m.length?e.jsx(n,{style:{color:"var(--tg-theme-destructive-text-color)",padding:"0 24px"},children:m.map((e=>e.message)).join(", ")}):null]})})),D=t=>e.jsx(y,{...t,component:P}),v=d.forwardRef((t=>{const{field:a,options:s,...l}=t,{isTouched:i,errors:o}=a.state.meta;return e.jsxs(e.Fragment,{children:[e.jsx(r,{...l,id:a.name,name:a.name,value:a.state.value,onBlur:a.handleBlur,onChange:e=>a.handleChange(e.target.value),children:s.map((({value:t,label:a})=>e.jsx("option",{value:t,children:a},t)))}),i&&o.length?e.jsx(n,{style:{color:"var(--tg-theme-destructive-text-color)",padding:"0 24px"},children:o.join(", ")}):null]})})),F={loanAmount:"",interestRate:"",loanTerm:"",startDate:(new Date).toISOString().split("T")[0],paymentType:"annuity",paymentDay:(new Date).getDate().toLocaleString(),earlyPayments:[],regularPayments:[]};g.object({id:g.string(),date:g.string().refine((e=>{const t=new Date(e);return!isNaN(t.getTime())}),"Invalid date format"),amount:g.string().transform((e=>{const t=p(e);return parseFloat(t)})).refine((e=>!isNaN(e)),"Amount must be a number").refine((e=>e>0),"Amount must be greater than 0"),type:g.enum(["reduceTerm","reducePayment"])});const T=g.object({loanAmount:g.string().transform((e=>{const t=p(e);return parseFloat(t)})).refine((e=>!isNaN(e)),"Loan amount must be a number").refine((e=>e>0),"Loan amount must be greater than 0").refine((e=>e<=1e9),"Loan amount is too large"),interestRate:g.string().transform((e=>{const t=p(e);return parseFloat(t)})).refine((e=>!isNaN(e)),"Interest rate must be a number").refine((e=>e>0),"Interest rate must be greater than 0").refine((e=>e<=100),"Interest rate cannot exceed 100%"),loanTerm:g.string().transform((e=>{const t=p(e);return parseFloat(t)})).refine((e=>!isNaN(e)),"Loan term must be a number").refine((e=>e>0),"Loan term must be greater than 0").refine((e=>e<=50),"Loan term cannot exceed 50 years"),startDate:g.string().refine((e=>{const t=new Date(e);return!isNaN(t.getTime())}),"Invalid start date"),paymentType:g.enum(["annuity","differentiated"]),paymentDay:g.string().transform((e=>parseInt(e))).refine((e=>!isNaN(e)),"Payment day must be a number").refine((e=>e>=1&&e<=31),"Payment day must be between 1 and 31")}),S=g.object({date:g.string().refine((e=>{const t=new Date(e);return!isNaN(t.getTime())}),"Invalid date format"),amount:g.string().transform((e=>{const t=p(e);return parseFloat(t)})).refine((e=>!isNaN(e)),"Amount must be a number").refine((e=>e>0),"Amount must be greater than 0"),type:g.enum(["reduceTerm","reducePayment"])}),N=g.object({id:g.string(),amount:g.string().transform((e=>{const t=p(e);return parseFloat(t)})).refine((e=>!isNaN(e)),"Amount must be a number").refine((e=>e>0),"Amount must be greater than 0"),startMonth:g.string().refine((e=>{const t=new Date(e);return!isNaN(t.getTime())}),"Invalid date format"),endMonth:g.string().refine((e=>{const t=new Date(e);return!isNaN(t.getTime())}),"Invalid date format"),type:g.enum(["reduceTerm","reducePayment"])}).refine((e=>{const t=new Date(e.startMonth);return new Date(e.endMonth)>=t}),{message:"End month must be after start month",path:["endMonth"]}),A=g.object({loanAmount:T.shape.loanAmount,interestRate:T.shape.interestRate,loanTerm:T.shape.loanTerm,startDate:T.shape.startDate,paymentType:T.shape.paymentType,paymentDay:T.shape.paymentDay,earlyPayments:g.array(S.extend({id:g.string()})),regularPayments:g.array(N)}),{fieldContext:C,formContext:M}=j(),{useAppForm:w,withForm:R}=f({fieldContext:C,formContext:M,fieldComponents:{},formComponents:{}}),I=x({defaultValues:F}),V=()=>{const{setLoanDetails:e,setEarlyPayments:t,setRegularPayments:a}=c(),n=u();return w({...I,validators:{onChange:A},onSubmit:async({value:r})=>{try{const l=(s=r,{loanAmount:parseFloat(p(s.loanAmount)),interestRate:parseFloat(p(s.interestRate)),loanTerm:parseFloat(p(s.loanTerm)),startDate:s.startDate,paymentType:s.paymentType,paymentDay:parseInt(s.paymentDay),earlyPayments:s.earlyPayments.map((e=>({...e,amount:parseFloat(p(e.amount))}))),regularPayments:s.regularPayments.map((e=>({...e,amount:parseFloat(p(e.amount))})))}),{earlyPayments:i,regularPayments:o,...m}=l;e(m),t(i),a(o),n("result")}catch(l){console.error("Form submission error:",l)}var s}})},k=R({...I,render:function({form:t}){const{t:a,language:n}=h();return e.jsx(s,{header:a("loanDetails"),children:e.jsxs(l,{children:[e.jsx(t.Field,{name:"loanAmount",children:t=>e.jsx(D,{header:a("loanAmount"),placeholder:a("loanAmount"),field:t,inputMode:"decimal",maximumFractionDigits:2})}),e.jsx(t.Field,{name:"interestRate",children:t=>e.jsx(D,{header:a("interestRate"),placeholder:a("interestRate"),field:t,format:"percent",inputMode:"decimal",maximumFractionDigits:2})}),e.jsx(t.Field,{name:"loanTerm",children:t=>e.jsx(D,{format:"unit",unit:"year",locales:n,header:a("loanTerm"),placeholder:a("loanTerm"),field:t,inputMode:"numeric",maximumIntegerDigits:2})}),e.jsx(t.Field,{name:"startDate",children:t=>e.jsx(P,{header:a("startDate"),placeholder:a("startDate"),field:t,type:"date"})}),e.jsx(t.Field,{name:"paymentType",children:t=>e.jsx(v,{header:a("paymentType"),field:t,options:[{label:a("annuityPayment"),value:"annuity"},{label:a("differentiatedPayment"),value:"differentiated"}]})}),e.jsx(t.Field,{name:"paymentDay",children:t=>e.jsx(v,{header:a("paymentDay"),field:t,options:Array.from({length:31},((e,t)=>t+1)).map((e=>({label:String(e),value:String(e)})))})})]})})}}),L=d.memo(k),B=R({...I,render:function({form:t}){const[a,n]=d.useState(!1),{t:r}=h();return e.jsx(s,{children:e.jsx(t.Field,{name:"earlyPayments",mode:"array",children:d=>e.jsxs(i,{expanded:a,onChange:()=>n((e=>!e)),children:[e.jsxs(i.Summary,{children:[r("earlyPayment"),Boolean(d.state.value.length)&&e.jsx(o,{large:!0,type:"dot",children:d.state.value.length})]}),e.jsx(i.Content,{style:{background:"transparent"},children:e.jsxs(s,{children:[d.state.value.map(((a,n)=>e.jsxs(l,{children:[e.jsx(t.Field,{name:`earlyPayments[${n}].amount`,children:t=>e.jsx(D,{header:r("earlyPaymentAmount"),placeholder:r("earlyPaymentAmount"),field:t,inputMode:"decimal",maximumFractionDigits:2})}),e.jsx(t.Field,{name:`earlyPayments[${n}].date`,children:t=>e.jsx(P,{header:r("earlyPaymentDate"),placeholder:r("earlyPaymentDate"),field:t,type:"date"})}),e.jsx(t.Field,{name:`earlyPayments[${n}].type`,children:t=>e.jsx(v,{header:r("earlyPaymentType"),field:t,options:[{label:r("typeReduceTerm"),value:"reduceTerm"},{label:r("typeReducePayment"),value:"reducePayment"}]})}),e.jsx(t.Subscribe,{selector:e=>[e.isFieldsValid,e.isValid],children:([t,a])=>e.jsx(m,{size:"s",mode:"outline",disabled:!t||!a,stretched:!0,onClick:()=>d.removeValue(n),children:r("remove")})})]},n))),e.jsx(t.Subscribe,{selector:e=>[e.isFieldsValid,e.isValid],children:([t,a])=>e.jsx(m,{disabled:!t||!a,stretched:!0,onClick:()=>d.pushValue({amount:"",date:(new Date).toISOString().split("T")[0],id:Date.now().toString(),type:"reduceTerm"}),children:r("addEarlyPayment")})})]})})]})})})}}),$=d.memo(B),O=R({...I,render:function({form:t}){const[a,n]=d.useState(!1),{t:r}=h();return e.jsx(s,{children:e.jsx(t.Field,{name:"regularPayments",mode:"array",children:d=>e.jsxs(i,{expanded:a,onChange:()=>n((e=>!e)),children:[e.jsxs(i.Summary,{children:[r("regularPayment"),Boolean(d.state.value.length)&&e.jsx(o,{large:!0,type:"dot",children:d.state.value.length})]}),e.jsx(i.Content,{style:{background:"transparent"},children:e.jsxs(s,{children:[d.state.value.map(((a,n)=>e.jsxs(l,{children:[e.jsx(t.Field,{name:`regularPayments[${n}].amount`,children:t=>e.jsx(D,{header:r("regularPaymentAmount"),placeholder:r("regularPaymentAmount"),field:t,inputMode:"decimal",maximumFractionDigits:2})}),e.jsx(t.Field,{name:`regularPayments[${n}].startMonth`,children:t=>e.jsx(P,{header:r("startMonth"),placeholder:r("startMonth"),field:t,type:"date"})}),e.jsx(t.Field,{name:`regularPayments[${n}].endMonth`,children:t=>e.jsx(P,{header:r("endMonth"),placeholder:r("endMonth"),field:t,type:"date"})}),e.jsx(t.Field,{name:`regularPayments[${n}].type`,children:t=>e.jsx(v,{header:r("earlyPaymentType"),field:t,options:[{label:r("typeReduceTerm"),value:"reduceTerm"},{label:r("typeReducePayment"),value:"reducePayment"}]})}),e.jsx(t.Subscribe,{selector:e=>[e.isFieldsValid,e.isValid],children:([t,a])=>e.jsx(m,{size:"s",mode:"outline",disabled:!t||!a,stretched:!0,onClick:()=>d.removeValue(n),children:r("remove")})})]},n))),e.jsx(t.Subscribe,{selector:e=>[e.isFieldsValid,e.isValid],children:([t,a])=>e.jsx(m,{disabled:!t||!a,stretched:!0,onClick:()=>{const e=new Date,t=new Date(e);t.setMonth(e.getMonth()+1),d.pushValue({amount:"",startMonth:e.toISOString().split("T")[0],endMonth:t.toISOString().split("T")[0],id:Date.now().toString(),type:"reduceTerm"})},children:r("addRegularPayment")})})]})})]})})})}}),z=d.memo(O),E=d.memo((()=>{const{t:t}=h(),a=V();return e.jsx(b,{back:!1,children:e.jsxs(l,{Component:"form",onSubmit:e=>{e.preventDefault(),e.stopPropagation(),a.handleSubmit()},children:[e.jsx(L,{form:a}),e.jsx($,{form:a}),e.jsx(z,{form:a}),e.jsx(s,{children:e.jsx(a.Subscribe,{selector:e=>[e.canSubmit,e.isSubmitting],children:([a,n])=>e.jsx(m,{type:"submit",stretched:!0,disabled:!a,loading:n,children:t("calculate")})})})]})})}));export{E as default};
//# sourceMappingURL=LoanForm-xzue0GL2.js.map
