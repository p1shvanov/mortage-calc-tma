const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/LoanForm-CVsg0RMQ.js","assets/vendor-telegram-DYpFzjZD.js","assets/vendor-react-BsEvrc09.js","assets/vendor-forms-B2qA07-X.js","assets/Page-D19Mk31s.js","assets/MortageResult-C3T5lNJr.js","assets/MortageResult-BCLBiihN.css","assets/eruda-DqHL8ifO.js"])))=>i.map(i=>d[i]);
import{j as e,$ as t,n as a,i as n,A as r,S as o,P as s,a as i,X as l,O as m,M as c,f as u,G as y,L as d,b as h,r as p,d as g,K as f,t as P,c as w,e as D}from"./vendor-telegram-DYpFzjZD.js";import{e as v,g as T,a as S,O as b,f as A,h as M}from"./vendor-react-BsEvrc09.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var x,E={};const R=T(function(){if(x)return E;x=1;var e=v();return E.createRoot=e.createRoot,E.hydrateRoot=e.hydrateRoot,E}()),_=S.memo((({error:t})=>e.jsxs("div",{children:[e.jsx("p",{children:"An unhandled error occurred:"}),e.jsx("blockquote",{children:e.jsx("code",{children:t instanceof Error?t.message:"string"==typeof t?t:JSON.stringify(t)})})]})));class j extends S.Component{state={};static getDerivedStateFromError=e=>({error:e});componentDidCatch(e){this.setState({error:e})}render(){const{state:{error:t},props:{fallback:a,children:n}}=this;return"error"in this.state?"function"==typeof a?e.jsx(a,{error:t}):a:n}}const I={},L=function(e,t,a){let n=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const e=document.querySelector("meta[property=csp-nonce]"),a=e?.nonce||e?.getAttribute("nonce");n=Promise.allSettled(t.map((e=>{if((e=function(e){return"/mortage-calc-tma/"+e}(e))in I)return;I[e]=!0;const t=e.endsWith(".css"),n=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${n}`))return;const r=document.createElement("link");return r.rel=t?"stylesheet":"modulepreload",t||(r.as="script"),r.crossOrigin="",r.href=e,a&&r.setAttribute("nonce",a),document.head.appendChild(r),t?new Promise(((t,a)=>{r.addEventListener("load",t),r.addEventListener("error",(()=>a(new Error(`Unable to preload CSS for ${e}`))))})):void 0})))}function r(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return n.then((t=>{for(const e of t||[])"rejected"===e.status&&r(e.reason);return e().catch(r)}))},C=S.memo((()=>{const o=t().tgWebAppPlatform,s=a(n.isDark);return e.jsx(r,{appearance:s?"dark":"light",platform:["macos","ios"].includes(o)?"ios":"base",children:e.jsx(b,{})})})),k=S.memo((()=>e.jsx(o,{visible:!0,style:{height:"100vh"}}))),B=S.lazy((()=>L((()=>import("./LoanForm-CVsg0RMQ.js")),__vite__mapDeps([0,1,2,3,4])))),O=S.lazy((()=>L((()=>import("./MortageResult-C3T5lNJr.js")),__vite__mapDeps([5,1,2,4,6])))),F=S.memo((()=>{const t=A([{path:"/",element:e.jsx(C,{}),children:[{index:!0,element:e.jsx(S.Suspense,{fallback:e.jsx(k,{}),children:e.jsx(B,{})})},{path:"/result",element:e.jsx(S.Suspense,{fallback:e.jsx(k,{}),children:e.jsx(O,{})})}]}],{basename:"/mortage-calc-tma/"});return e.jsx(M,{router:t})})),U=S.memo((()=>e.jsx(F,{}))),z={en:{appTitle:"Mortgage Calculator",mustBeNumber:"{field} must be a number",mustBeGreaterThan:"{field} must be greater than {value}",mustBeLessThan:"{field} must be less than or equal to {value}",invalidDate:"{field} has an invalid date format",endDateAfterStart:"{endField} must be after {startField}",invalidNumber:"Must be a valid number",mustBePositive:"Must be a positive number",dayOfMonth:"Day must be between 1 and 31",loanDetails:"Loan Details",homeValue:"Home Value",downPayment:"Down Payment",loanAmount:"Loan Amount",interestRate:"Interest Rate",loanTerm:"Loan Term (years)",startDate:"Start Date",paymentType:"Payment Type",annuityPayment:"Annuity",differentiatedPayment:"Differentiated",paymentDay:"Payment Day",paymentDayMonthly:"Same day as start date",paymentDaySpecific:"Specific day of month",paymentSummary:"Payment Summary",monthlyPayment:"Monthly Payment",totalInterest:"Total Interest",totalCost:"Total Cost",planPayoffDate:"Plan Payoff Date",actualPayoffDate:"Actual Payoff Date",earlyPayment:"Early Payment",earlyPaymentAmount:"Additional Amount",earlyPaymentMonth:"Month of Payment",earlyPaymentDate:"Date of Payment",earlyPaymentType:"Payment Type",typeReduceTerm:"Reduce Term",typeReducePayment:"Reduce Payment",addEarlyPayment:"Add Early Payment",earlyPaymentList:"Scheduled Early Payments",remove:"Remove",paymentHistory:"Early Payments",totalEarlyPayments:"Total Early Payments",errorPaymentAmount:"Payment amount must be greater than 0",errorPaymentMonth:"Payment month must be within the loan term",errorPaymentDate:"Payment date must be within the loan term",regularPayment:"Regular Payment",regularPaymentAmount:"Regular Payment Amount",startMonth:"Start Month",endMonth:"End Month (Optional)",addRegularPayment:"Add Regular Payment",yes:"Yes",finalPayment:"Final Payment",originalPayment:"Original Payment",savings:"Interest Savings",monthsSaved:"Months Saved",totalSavings:"Total Interest Savings",amortization:"Amortization Schedule",paymentSchedule:"Payment Schedule",month:"Month",date:"Date",payment:"Payment",principal:"Principal",interest:"Interest",extraPayment:"Extra Payment",balance:"Balance",previous:"Previous",next:"Next",showingPayments:"Showing payments {from}-{to} of {total}",graphicalView:"Graphical View",paymentBreakdown:"Payment Breakdown",amortizationSchedule:"Amortization Schedule",paymentAmount:"Payment Amount",paymentDistribution:"Payment Distribution",interestSavings:"Interest Savings",newTotalInterest:"New Total Interest",interestSaved:"Interest Saved",monthlyPaymentBreakdown:"Monthly Payment Breakdown",totalPaymentBreakdown:"Total Payment Breakdown",mortgageComparison:"Mortgage Comparison",original:"Original Mortgage",withEarlyPayments:"With Early Payments",errorHomeValue:"Home value must be greater than 0",errorDownPayment:"Down payment must be greater than 0",errorDownPaymentMax:"Down payment must be less than home value",errorInterestRate:"Interest rate must be greater than 0",errorLoanTerm:"Loan term must be greater than 0",calculate:"Calculate",reset:"Reset",years:"years",months:"months"},ru:{appTitle:"Ипотечный калькулятор",mustBeNumber:"{field} должен быть числом",mustBeGreaterThan:"{field} должен быть больше {value}",mustBeLessThan:"{field} должен быть меньше или равен {value}",invalidDate:"{field} имеет неверный формат даты",endDateAfterStart:"{endField} должен быть после {startField}",invalidNumber:"Должно быть действительным числом",mustBePositive:"Должно быть положительным числом",dayOfMonth:"День должен быть между 1 и 31",loanDetails:"Детали кредита",homeValue:"Стоимость недвижимости",downPayment:"Первоначальный взнос",loanAmount:"Сумма кредита",interestRate:"Процентная ставка",loanTerm:"Срок кредита (лет)",startDate:"Дата начала",paymentType:"Тип платежа",annuityPayment:"Аннуитетный",differentiatedPayment:"Дифференцированный",paymentDay:"День платежа",paymentDayMonthly:"В тот же день, что и дата начала",paymentDaySpecific:"Конкретный день месяца",paymentSummary:"Сводка по платежам",monthlyPayment:"Ежемесячный платеж",totalInterest:"Общий процент",totalCost:"Общая стоимость",planPayoffDate:"Плановая дата погашения",actualPayoffDate:"Фактическая дата погашения",earlyPayment:"Досрочное погашение",earlyPaymentAmount:"Дополнительная сумма",earlyPaymentMonth:"Месяц платежа",earlyPaymentDate:"Дата платежа",earlyPaymentType:"Тип платежа",typeReduceTerm:"Сократить срок",typeReducePayment:"Уменьшить платеж",addEarlyPayment:"Добавить досрочный платеж",earlyPaymentList:"Запланированные досрочные платежи",remove:"Удалить",paymentHistory:"Досрочные платежи",totalEarlyPayments:"Всего досрочных платежей",errorPaymentAmount:"Сумма платежа должна быть больше 0",errorPaymentMonth:"Месяц платежа должен быть в пределах срока кредита",errorPaymentDate:"Дата платежа должна быть в пределах срока кредита",regularPayment:"Регулярный платеж",regularPaymentAmount:"Сумма регулярного платежа",startMonth:"Месяц начала",endMonth:"Месяц окончания (Опционально)",addRegularPayment:"Добавить регулярный платеж",yes:"Да",finalPayment:"Итоговый платеж",originalPayment:"Первоначальный платеж",savings:"Экономия на процентах",monthsSaved:"Сэкономлено месяцев",totalSavings:"Общая экономия на процентах",amortization:"График платежей",paymentSchedule:"График платежей",month:"Месяц",date:"Дата",payment:"Платеж",principal:"Основной долг",interest:"Проценты",extraPayment:"Досрочный платеж",balance:"Остаток",previous:"Назад",next:"Вперед",showingPayments:"Платежи {from}-{to} из {total}",graphicalView:"Графическое представление",paymentBreakdown:"Структура платежа",amortizationSchedule:"График погашения",paymentAmount:"Сумма платежа",paymentDistribution:"Распределение платежей",interestSavings:"Экономия на процентах",newTotalInterest:"Новая общая сумма процентов",interestSaved:"Сэкономленные проценты",monthlyPaymentBreakdown:"Ежемесячная структура платежей",totalPaymentBreakdown:"Общая структура платежей",mortgageComparison:"Сравнение ипотеки",original:"Первоначальная ипотека",withEarlyPayments:"С досрочными платежами",errorHomeValue:"Стоимость недвижимости должна быть больше 0",errorDownPayment:"Первоначальный взнос должен быть больше 0",errorDownPaymentMax:"Первоначальный взнос должен быть меньше стоимости жилья",errorInterestRate:"Процентная ставка должна быть больше 0",errorLoanTerm:"Срок кредита должен быть больше 0",calculate:"Рассчитать",reset:"Сбросить",years:"лет",months:"месяцев"}},N=S.createContext(void 0),V=()=>{const e=S.useContext(N);if(!e)throw new Error("useLocalization must be used within a LocalizationProvider");return e},W=({children:a})=>{const[n,r]=S.useState((()=>{try{const e=t();return"ru"===(e.tgWebAppData?.user?.language_code||"en")?"ru":"en"}catch(e){return console.error("Error retrieving user language:",e),"en"}})());return e.jsx(N.Provider,{value:{language:n,setLanguage:r,t:(e,t)=>{const a=z.en,r=z[n][e]||a[e]||e;return t?Object.entries(t).reduce(((e,[t,a])=>e.replace(`{${t}}`,String(a))),r):r},formatCurrency:e=>"ru"===n?new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB",minimumFractionDigits:0,maximumFractionDigits:0}).format(e):new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),formatNumber:e=>new Intl.NumberFormat("ru"===n?"ru-RU":"en-US").format(e),formatDate:e=>("string"==typeof e?new Date(e):e).toLocaleDateString("ru"===n?"ru-RU":"en-US")},children:a})};var H=(e=>(e.ACTUAL_365="ACTUAL_365",e.THIRTY_360="THIRTY_360",e.ACTUAL_ACTUAL="ACTUAL_ACTUAL",e))(H||{});function Y(e,t,a,n="annuity",r=1){if("differentiated"===n)return function(e,t,a,n=1){const r=e/(12*a);return r+t/100/12*(e-r*(n-1))}(e,t,a,r);const o=t/100/12,s=12*a;return e*o*Math.pow(1+o,s)/(Math.pow(1+o,s)-1)}function q(e,t){const a=Math.abs(t.getTime()-e.getTime());return Math.round(a/864e5)}function $(e){const t=e.getFullYear();return t%4==0&&t%100!=0||t%400==0?366:365}function G(e,t,a,n,r="ACTUAL_365"){if("ACTUAL_365"===r){const r=q(a,n);return e*(t/100/$(a))*r}{const r=q(a,n);return e*(t/100/$(a))*r}}function K(e){const{loanAmount:t,interestRate:a,loanTerm:n,startDate:r,paymentType:o="annuity"}=e,s=Y(t,a,n,o);let i;if("differentiated"===o){let e=0;const r=12*n;for(let s=1;s<=r;s++)e+=Y(t,a,n,o,s);i=e}else i=s*n*12;const l=i-t,m=function(e,t){const a=new Date(e);return a.setFullYear(a.getFullYear()+t),a.toISOString().split("T")[0]}(r,n);return{monthlyPayment:s,totalInterest:l,totalCost:i,payoffDate:m,loanTerm:n,paymentType:o}}class J{async calculateMortgage(e){const t=K({loanAmount:e.loanAmount,interestRate:e.interestRate,loanTerm:e.loanTerm,startDate:e.startDate,paymentType:e.paymentType,paymentDay:e.paymentDay});return{monthlyPayment:t.monthlyPayment,totalInterest:t.totalInterest,totalCost:t.totalCost,payoffDate:t.payoffDate,loanTerm:t.loanTerm,paymentType:t.paymentType,effectiveInterestRate:t.effectiveInterestRate}}async generateAmortizationSchedule(e){const t=function(e){const{loanAmount:t,interestRate:a,loanTerm:n,startDate:r,earlyPayments:o=[],regularPayments:s=[],paymentType:i="annuity",interestCalculationMethod:l=H.ACTUAL_365}=e,m=12*n,c=a/100/12;let u;u="differentiated"===i?t/m+t*c:t*c*Math.pow(1+c,m)/(Math.pow(1+c,m)-1);const y=[...o].sort(((e,t)=>new Date(e.date).getTime()-new Date(t.date).getTime())),d=new Map;y.forEach((e=>{d.set(e.date,{amount:e.amount,type:e.type})}));const h=[];let p=t,g=0,f=u;const P=new Date(r);let w;if("differentiated"===i){let e=0,a=t;const n=t/m;for(let t=0;t<m;t++)e+=n+a*c,a-=n;w=e-t}else w=u*m-t;let D=!1,v=new Date(P),T=1,S=m;for(;T<=S&&p>.01;){const r=new Date(v);if(r.setMonth(v.getMonth()+1),void 0!==e.paymentDay){const t=r.getFullYear(),a=r.getMonth(),n=new Date(t,a+1,0).getDate(),o=Math.min(e.paymentDay,n);r.setDate(o)}const o=G(p,a,v,r,l);let u,y;"differentiated"===i?(u=t/(12*n),y=u+o,f=y):(u=f-o,y=f);let P=p-u;const w=r.toISOString().split("T")[0];let b,A=0,M=!1;if(d.has(w)){const e=d.get(w);A=e.amount,b=e.type}const x=new Date(w);for(const e of s){const t=new Date(e.startMonth),a=e.endMonth?new Date(e.endMonth):null;x>=t&&(!a||x<=a)&&(A>0?(A+=e.amount,b=e.type):(A=e.amount,b=e.type),M=!0)}if(A>0&&(P-=A,P>0))if("reducePayment"===b){D=!0;const e=m-T+1;S=e,f=P*c*Math.pow(1+c,e)/(Math.pow(1+c,e)-1)}else if("reduceTerm"===b){const e=Math.ceil(Math.log(f/(f-P*c))/Math.log(1+c));S=D?Math.min(S,e):Math.min(S,T+e)}g+=o,h.push({month:T,date:w,payment:f,principal:u,interest:o,totalInterest:g,balance:Math.max(0,P),extraPayment:A>0?A:void 0,extraPaymentType:A>0?b:void 0,isRegularPayment:M}),p=P,v=r,T++}const b=g;return{schedule:h,summary:{originalTerm:m,newTerm:h.length,originalTotalInterest:w,newTotalInterest:b,originalMonthlyPayment:u,finalMonthlyPayment:h[h.length-1].payment,totalSavings:w-b,paymentType:i}}}({loanAmount:e.loanAmount,interestRate:e.interestRate,loanTerm:e.loanTerm,startDate:e.startDate,paymentType:e.paymentType,paymentDay:e.paymentDay,earlyPayments:e.earlyPayments||[],regularPayments:e.regularPayments||[]});return t}}class X{_apiBaseUrl;constructor(e){this._apiBaseUrl=e||"/api/mortgage"}async calculateMortgage(e){try{throw new Error("Server implementation not available yet")}catch(t){throw console.error("Error calculating mortgage:",t),t}}async generateAmortizationSchedule(e){try{throw new Error("Server implementation not available yet")}catch(t){throw console.error("Error generating amortization schedule:",t),t}}}const Q="local",Z="/api/mortgage";const ee=class{static createMortgageService(e="local",t){switch(e){case"local":return new J;case"server":try{return new X(t)}catch(a){return console.warn("Error creating server implementation, falling back to local implementation:",a),new J}default:return new J}}}.createMortgageService(Q,Z),te=S.createContext(void 0);function ae({children:t}){const[a,n]=S.useState(null),[r,o]=S.useState([]),[s,i]=S.useState([]),[l,m]=S.useState(null),[c,u]=S.useState(null);return S.useEffect((()=>{if(a)try{ee.calculateMortgage({...a,earlyPayments:r,regularPayments:s}).then((e=>{m(e)})).catch((e=>{console.error("Error calculating mortgage results:",e)}))}catch(e){console.error("Error calculating mortgage results:",e)}}),[a]),S.useEffect((()=>{if(a)try{ee.generateAmortizationSchedule({...a,earlyPayments:r,regularPayments:s}).then((e=>{u(e)})).catch((e=>{console.error("Error generating amortization schedule:",e)}))}catch(e){console.error("Error generating amortization schedule:",e)}}),[a,r,s]),e.jsx(te.Provider,{value:{loanDetails:a,setLoanDetails:n,earlyPayments:r,setEarlyPayments:o,regularPayments:s,setRegularPayments:i,mortgageResults:l,amortizationResult:c,setMortgageResults:m,setAmortizationResult:u},children:t})}function ne(){const e=S.useContext(te);if(!e)throw new Error("useMortgage must be used within a MortgageProvider");return e}const re=S.memo((()=>e.jsx(j,{fallback:_,children:e.jsx(W,{children:e.jsx(ae,{children:e.jsx(U,{})})})}))),oe=S.memo((()=>{const o=t().tgWebAppPlatform,i=a(n.isDark);return e.jsx(r,{appearance:i?"dark":"light",platform:["macos","ios"].includes(o)?"ios":"base",children:e.jsx(s,{header:"Oops",description:"You are using too old Telegram client to run this application",children:e.jsx("img",{alt:"Telegram sticker",src:"https://xelene.me/telegram.gif",style:{display:"block",width:"144px",height:"144px"}})})})}));const se=R.createRoot(document.getElementById("root"));try{const a=t(),{tgWebAppPlatform:r}=a,o=(a.tgWebAppStartParam||"").includes("platformer_debug")||!1;await async function(e){if(i(e.debug),l(),e.eruda&&L((async()=>{const{default:e}=await import("./eruda-DqHL8ifO.js").then((e=>e.e));return{default:e}}),__vite__mapDeps([7,2])).then((({default:e})=>{e.init(),e.position({x:window.innerWidth-50,y:0})})),e.mockForMacOS){let e=!1;m({onEvent(a,n){if("web_app_request_theme"===a[0]){let a={};return e?a=w():(e=!0,a||=t().tgWebAppThemeParams),D("theme_changed",{theme_params:a})}if("web_app_request_safe_area"===a[0])return D("safe_area_changed",{left:0,top:0,right:0,bottom:0});n()}})}c(),n.mountSync(),await Promise.all([u.mount().then((()=>{y.isSupported()&&y.mount(),d(),h(),p(),g.mount(),g.disableVertical(),f.mount(),f.enableConfirmation(),P()}))])}({debug:o,eruda:o&&["ios","android"].includes(r),mockForMacOS:"macos"===r}).then((()=>{se.render(e.jsx(re,{}))}))}catch(ie){console.log(ie),se.render(e.jsx(oe,{}))}export{L as _,ne as a,V as u};
//# sourceMappingURL=index-Cp98w5qd.js.map
