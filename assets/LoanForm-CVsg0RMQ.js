import{j as e,I as a,g as t,C as n,h as r,k as l,l as s,m as i,B as m,o}from"./vendor-telegram-DYpFzjZD.js";import{a as d,u}from"./vendor-react-BsEvrc09.js";import{u as c,a as h}from"./index-Cp98w5qd.js";import{u as y,x as p,z as f,c as g,f as x,a as j}from"./vendor-forms-B2qA07-X.js";import{P as D}from"./Page-D19Mk31s.js";const P=d.forwardRef(((r,l)=>{const{field:s,...i}=r,{isTouched:m,errors:o,isValidating:d}=s.state.meta;return e.jsxs(e.Fragment,{children:[e.jsx(a,{...i,ref:l,id:s.name,name:s.name,value:s.state.value,onBlur:s.handleBlur,onChange:e=>s.handleChange(e.target.value),status:o.length?"error":"default",after:d?e.jsx(t,{size:"s"}):i.after}),m&&o.length?e.jsx(n,{style:{color:"var(--tg-theme-destructive-text-color)",padding:"0 24px"},children:o.map((e=>e.message)).join(", ")}):null]})})),b=a=>e.jsx(y,{...a,component:P}),F=d.forwardRef((a=>{const{field:t,options:l,...s}=a,{isTouched:i,errors:m}=t.state.meta;return e.jsxs(e.Fragment,{children:[e.jsx(r,{...s,id:t.name,name:t.name,value:t.state.value,onBlur:t.handleBlur,onChange:e=>t.handleChange(e.target.value),children:l.map((({value:a,label:t})=>e.jsx("option",{value:a,children:t},a)))}),i&&m.length?e.jsx(n,{style:{color:"var(--tg-theme-destructive-text-color)",padding:"0 24px"},children:m.join(", ")}):null]})})),S={loanAmount:"",interestRate:"",loanTerm:"",startDate:(new Date).toISOString().split("T")[0],paymentType:"annuity",paymentDay:(new Date).getDate().toLocaleString(),earlyPayments:[],regularPayments:[]};const v=()=>{const{t:e,language:a}=c(),t=d.useMemo((()=>(e=>(f.setErrorMap(((a,t)=>{const n=f.defaultErrorMap(a,t);switch(a.code){case f.ZodIssueCode.invalid_type:if("number"===a.expected)return{message:e("invalidNumber")};break;case f.ZodIssueCode.too_small:if("number"===a.type&&0===a.minimum)return{message:e("mustBePositive")}}return n})),{createNumberSchema:a=>{const{fieldName:t,min:n=0,max:r}=a;return f.string().transform((e=>{const a=p(e);return parseFloat(a)})).refine((e=>!isNaN(e)),e("mustBeNumber",{field:e(t)})).refine((e=>e>n),e("mustBeGreaterThan",{field:e(t),value:n})).refine((e=>void 0===r||e<=r),void 0!==r?e("mustBeLessThan",{field:e(t),value:r}):"")},createDateSchema:a=>{const{fieldName:t}=a;return f.string().refine((e=>{const a=new Date(e);return!isNaN(a.getTime())}),e("invalidDate",{field:e(t)}))},createDateRangeRefinement:e=>{const{startField:a,endField:t,endIsOptional:n=!1}=e;return e=>{if(n&&!e[t])return!0;const r=new Date(e[a]);return new Date(e[t])>=r}},getDateRangeErrorMessage:a=>{const{startField:t,endField:n}=a;return{message:e("endDateAfterStart",{startField:e(t),endField:e(n)}),path:[n]}}}))(e)),[e,a]);return t},{fieldContext:M,formContext:T}=j(),{useAppForm:N,withForm:R}=g({fieldContext:M,formContext:T,fieldComponents:{},formComponents:{}}),C=x({defaultValues:S}),A=()=>{const{setLoanDetails:e,setEarlyPayments:a,setRegularPayments:t}=h(),n=u(),{formSchema:r}=(()=>{const e=v(),a=f.object({loanAmount:e.createNumberSchema({fieldName:"loanAmount",min:0,max:1e9}),interestRate:e.createNumberSchema({fieldName:"interestRate",min:0,max:100}),loanTerm:e.createNumberSchema({fieldName:"loanTerm",min:0,max:50}),startDate:e.createDateSchema({fieldName:"startDate"}),paymentType:f.enum(["annuity","differentiated"]),paymentDay:f.string().transform((e=>parseInt(e))).refine((e=>!isNaN(e)),"validation.mustBeNumber").refine((e=>e>=1&&e<=31),"validation.dayOfMonth")}),t=f.object({date:e.createDateSchema({fieldName:"earlyPaymentDate"}),amount:e.createNumberSchema({fieldName:"earlyPaymentAmount",min:0}),type:f.enum(["reduceTerm","reducePayment"])}),n=f.object({id:f.string(),amount:e.createNumberSchema({fieldName:"regularPaymentAmount",min:0}),startMonth:e.createDateSchema({fieldName:"startMonth"}),endMonth:e.createDateSchema({fieldName:"endMonth"}),type:f.enum(["reduceTerm","reducePayment"])}).refine(e.createDateRangeRefinement({startField:"startMonth",endField:"endMonth"}),e.getDateRangeErrorMessage({startField:"startMonth",endField:"endMonth"})),r=f.object({amount:e.createNumberSchema({fieldName:"regularPaymentAmount",min:0}),startMonth:e.createDateSchema({fieldName:"startMonth"}),endMonth:e.createDateSchema({fieldName:"endMonth"}).optional(),type:f.enum(["reduceTerm","reducePayment"])}).refine(e.createDateRangeRefinement({startField:"startMonth",endField:"endMonth",endIsOptional:!0}),e.getDateRangeErrorMessage({startField:"startMonth",endField:"endMonth"})),l=f.object({loanAmount:a.shape.loanAmount,interestRate:a.shape.interestRate,loanTerm:a.shape.loanTerm,startDate:a.shape.startDate,paymentType:a.shape.paymentType,paymentDay:a.shape.paymentDay,earlyPayments:f.array(t.extend({id:f.string()})),regularPayments:f.array(n)});return{loanDetailsSchema:a,earlyPaymentSchema:t,regularPaymentSchema:n,regularEarlyPaymentSchema:r,formSchema:l}})();return N({...C,validators:{onChange:r},onSubmit:async({value:r})=>{try{const s=(l=r,{loanAmount:parseFloat(p(l.loanAmount)),interestRate:parseFloat(p(l.interestRate)),loanTerm:parseFloat(p(l.loanTerm)),startDate:l.startDate,paymentType:l.paymentType,paymentDay:parseInt(l.paymentDay),earlyPayments:l.earlyPayments.map((e=>({...e,amount:parseFloat(p(e.amount))}))),regularPayments:l.regularPayments.map((e=>({...e,amount:parseFloat(p(e.amount))})))}),{earlyPayments:i,regularPayments:m,...o}=s;e(o),a(i),t(m),n("result")}catch(s){console.error("Form submission error:",s)}var l}})},w=R({...C,render:function({form:a}){const{t:t,language:n}=c();return e.jsx(l,{header:t("loanDetails"),children:e.jsxs(s,{children:[e.jsx(a.Field,{name:"loanAmount",children:a=>e.jsx(b,{header:t("loanAmount"),placeholder:t("loanAmount"),field:a,inputMode:"decimal",maximumFractionDigits:2})}),e.jsx(a.Field,{name:"interestRate",children:a=>e.jsx(b,{header:t("interestRate"),placeholder:t("interestRate"),field:a,format:"percent",inputMode:"decimal",maximumFractionDigits:2})}),e.jsx(a.Field,{name:"loanTerm",children:a=>e.jsx(b,{format:"unit",unit:"year",locales:n,header:t("loanTerm"),placeholder:t("loanTerm"),field:a,inputMode:"numeric",maximumIntegerDigits:2})}),e.jsx(a.Field,{name:"startDate",children:a=>e.jsx(P,{header:t("startDate"),placeholder:t("startDate"),field:a,type:"date"})}),e.jsx(a.Field,{name:"paymentType",children:a=>e.jsx(F,{header:t("paymentType"),field:a,options:[{label:t("annuityPayment"),value:"annuity"},{label:t("differentiatedPayment"),value:"differentiated"}]})}),e.jsx(a.Field,{name:"paymentDay",children:a=>e.jsx(F,{header:t("paymentDay"),field:a,options:Array.from({length:31},((e,a)=>a+1)).map((e=>({label:String(e),value:String(e)})))})})]})})}}),V=d.memo(w),B=R({...C,render:function({form:a}){const[t,n]=d.useState(!1),{t:r}=c();return e.jsx(l,{children:e.jsx(a.Field,{name:"earlyPayments",mode:"array",children:d=>e.jsxs(i,{expanded:t,onChange:()=>n((e=>!e)),children:[e.jsxs(i.Summary,{children:[r("earlyPayment"),Boolean(d.state.value.length)&&e.jsx(m,{large:!0,type:"dot",children:d.state.value.length})]}),e.jsx(i.Content,{style:{background:"transparent"},children:e.jsxs(l,{children:[d.state.value.map(((t,n)=>e.jsxs(s,{children:[e.jsx(a.Field,{name:`earlyPayments[${n}].amount`,children:a=>e.jsx(b,{header:r("earlyPaymentAmount"),placeholder:r("earlyPaymentAmount"),field:a,inputMode:"decimal",maximumFractionDigits:2})}),e.jsx(a.Field,{name:`earlyPayments[${n}].date`,children:a=>e.jsx(P,{header:r("earlyPaymentDate"),placeholder:r("earlyPaymentDate"),field:a,type:"date"})}),e.jsx(a.Field,{name:`earlyPayments[${n}].type`,children:a=>e.jsx(F,{header:r("earlyPaymentType"),field:a,options:[{label:r("typeReduceTerm"),value:"reduceTerm"},{label:r("typeReducePayment"),value:"reducePayment"}]})}),e.jsx(a.Subscribe,{selector:e=>[e.isFieldsValid,e.isValid],children:([a,t])=>e.jsx(o,{size:"s",mode:"outline",disabled:!a||!t,stretched:!0,onClick:()=>d.removeValue(n),children:r("remove")})})]},n))),e.jsx(a.Subscribe,{selector:e=>[e.isFieldsValid,e.isValid],children:([a,t])=>e.jsx(o,{disabled:!a||!t,stretched:!0,onClick:()=>d.pushValue({amount:"",date:(new Date).toISOString().split("T")[0],id:Date.now().toString(),type:"reduceTerm"}),children:r("addEarlyPayment")})})]})})]})})})}}),I=d.memo(B),k=R({...C,render:function({form:a}){const[t,n]=d.useState(!1),{t:r}=c();return e.jsx(l,{children:e.jsx(a.Field,{name:"regularPayments",mode:"array",children:d=>e.jsxs(i,{expanded:t,onChange:()=>n((e=>!e)),children:[e.jsxs(i.Summary,{children:[r("regularPayment"),Boolean(d.state.value.length)&&e.jsx(m,{large:!0,type:"dot",children:d.state.value.length})]}),e.jsx(i.Content,{style:{background:"transparent"},children:e.jsxs(l,{children:[d.state.value.map(((t,n)=>e.jsxs(s,{children:[e.jsx(a.Field,{name:`regularPayments[${n}].amount`,children:a=>e.jsx(b,{header:r("regularPaymentAmount"),placeholder:r("regularPaymentAmount"),field:a,inputMode:"decimal",maximumFractionDigits:2})}),e.jsx(a.Field,{name:`regularPayments[${n}].startMonth`,children:a=>e.jsx(P,{header:r("startMonth"),placeholder:r("startMonth"),field:a,type:"date"})}),e.jsx(a.Field,{name:`regularPayments[${n}].endMonth`,children:a=>e.jsx(P,{header:r("endMonth"),placeholder:r("endMonth"),field:a,type:"date"})}),e.jsx(a.Field,{name:`regularPayments[${n}].type`,children:a=>e.jsx(F,{header:r("earlyPaymentType"),field:a,options:[{label:r("typeReduceTerm"),value:"reduceTerm"},{label:r("typeReducePayment"),value:"reducePayment"}]})}),e.jsx(a.Subscribe,{selector:e=>[e.isFieldsValid,e.isValid],children:([a,t])=>e.jsx(o,{size:"s",mode:"outline",disabled:!a||!t,stretched:!0,onClick:()=>d.removeValue(n),children:r("remove")})})]},n))),e.jsx(a.Subscribe,{selector:e=>[e.isFieldsValid,e.isValid],children:([a,t])=>e.jsx(o,{disabled:!a||!t,stretched:!0,onClick:()=>{const e=new Date,a=new Date(e);a.setMonth(e.getMonth()+1),d.pushValue({amount:"",startMonth:e.toISOString().split("T")[0],endMonth:a.toISOString().split("T")[0],id:Date.now().toString(),type:"reduceTerm"})},children:r("addRegularPayment")})})]})})]})})})}}),E=d.memo(k),O=d.memo((()=>{const{t:a}=c(),t=A();return e.jsx(D,{back:!1,children:e.jsxs(s,{Component:"form",onSubmit:e=>{e.preventDefault(),e.stopPropagation(),t.handleSubmit()},children:[e.jsx(V,{form:t}),e.jsx(I,{form:t}),e.jsx(E,{form:t}),e.jsx(l,{children:e.jsx(t.Subscribe,{selector:e=>[e.canSubmit,e.isSubmitting],children:([t,n])=>e.jsx(o,{type:"submit",stretched:!0,disabled:!t,loading:n,children:a("calculate")})})})]})})}));export{O as default};
//# sourceMappingURL=LoanForm-CVsg0RMQ.js.map
