import{j as e,I as a,g as t,C as n,h as r,k as l,l as s,m as i,B as d,o}from"./vendor-telegram-DYpFzjZD.js";import{a as m,u}from"./vendor-react-BsEvrc09.js";import{u as c,a as h}from"./index-BIEE1WAi.js";import{u as y,x as p,c as x,f as j,a as g}from"./vendor-forms-Dm5uatUg.js";import{P as f}from"./Page-D19Mk31s.js";const P=m.forwardRef(((r,l)=>{const{field:s,...i}=r,{isTouched:d,errors:o,isValidating:m}=s.state.meta;return e.jsxs(e.Fragment,{children:[e.jsx(a,{...i,ref:l,id:s.name,name:s.name,value:s.state.value,onBlur:s.handleBlur,onChange:e=>s.handleChange(e.target.value),status:o.length?"error":"default",after:m?e.jsx(t,{size:"s"}):i.after}),d&&o.length?e.jsx(n,{style:{color:"var(--tg-theme-destructive-text-color)",padding:"0 24px"},children:o.map((e=>e.message)).join(", ")}):null]})})),v=a=>e.jsx(y,{...a,component:P}),b=m.forwardRef((a=>{const{field:t,options:l,...s}=a,{isTouched:i,errors:d}=t.state.meta;return e.jsxs(e.Fragment,{children:[e.jsx(r,{...s,id:t.name,name:t.name,value:t.state.value,onBlur:t.handleBlur,onChange:e=>t.handleChange(e.target.value),children:l.map((({value:a,label:t})=>e.jsx("option",{value:a,children:t},a)))}),i&&d.length?e.jsx(n,{style:{color:"var(--tg-theme-destructive-text-color)",padding:"0 24px"},children:d.join(", ")}):null]})})),F={loanAmount:"",interestRate:"",loanTerm:"",startDate:(new Date).toISOString().split("T")[0],paymentType:"annuity",paymentDay:(new Date).getDate().toLocaleString(),earlyPayments:[],regularPayments:[]};const{fieldContext:D,formContext:S}=g(),{useAppForm:T,withForm:C}=x({fieldContext:D,formContext:S,fieldComponents:{},formComponents:{}}),R=j({defaultValues:F}),V=()=>{const{setLoanDetails:e,setEarlyPayments:a,setRegularPayments:t}=c(),n=u();return T({...R,onSubmit:async({value:r})=>{try{const s=(l=r,{loanAmount:parseFloat(p(l.loanAmount)),interestRate:parseFloat(p(l.interestRate)),loanTerm:parseFloat(p(l.loanTerm)),startDate:l.startDate,paymentType:l.paymentType,paymentDay:parseInt(l.paymentDay),earlyPayments:l.earlyPayments.map((e=>({...e,amount:parseFloat(p(e.amount))}))),regularPayments:l.regularPayments.map((e=>({...e,amount:parseFloat(p(e.amount))})))}),{earlyPayments:i,regularPayments:d,...o}=s;e(o),a(i),t(d),n("result")}catch(s){console.log(s)}var l}})},M=C({...R,render:function({form:a}){const{t:t,language:n}=h();return e.jsx(l,{header:t("loanDetails"),children:e.jsxs(s,{children:[e.jsx(a.Field,{name:"loanAmount",children:a=>e.jsx(v,{header:t("loanAmount"),placeholder:t("loanAmount"),field:a,inputMode:"decimal",maximumFractionDigits:2})}),e.jsx(a.Field,{name:"interestRate",children:a=>e.jsx(v,{header:t("interestRate"),placeholder:t("interestRate"),field:a,format:"percent",inputMode:"decimal",maximumFractionDigits:2})}),e.jsx(a.Field,{name:"loanTerm",children:a=>e.jsx(v,{format:"unit",unit:"year",locales:n,header:t("loanTerm"),placeholder:t("loanTerm"),field:a,inputMode:"numeric",maximumIntegerDigits:2})}),e.jsx(a.Field,{name:"startDate",children:a=>e.jsx(P,{header:t("startDate"),placeholder:t("startDate"),field:a,type:"date"})}),e.jsx(a.Field,{name:"paymentType",children:a=>e.jsx(b,{header:t("paymentType"),field:a,options:[{label:t("annuityPayment"),value:"annuity"},{label:t("differentiatedPayment"),value:"differentiated"}]})}),e.jsx(a.Field,{name:"paymentDay",children:a=>e.jsx(b,{header:t("paymentDay"),field:a,options:Array.from({length:31},((e,a)=>a+1)).map((e=>({label:String(e),value:String(e)})))})})]})})}}),A=m.memo(M),w=C({...R,render:function({form:a}){const[t,n]=m.useState(!1),{t:r}=h();return e.jsx(l,{children:e.jsx(a.Field,{name:"earlyPayments",mode:"array",children:m=>e.jsxs(i,{expanded:t,onChange:()=>n((e=>!e)),children:[e.jsxs(i.Summary,{children:[r("earlyPayment"),Boolean(m.state.value.length)&&e.jsx(d,{large:!0,type:"dot",children:m.state.value.length})]}),e.jsx(i.Content,{style:{background:"transparent"},children:e.jsxs(l,{children:[m.state.value.map(((t,n)=>e.jsxs(s,{children:[e.jsx(a.Field,{name:`earlyPayments[${n}].amount`,children:a=>e.jsx(v,{header:r("earlyPaymentAmount"),placeholder:r("earlyPaymentAmount"),field:a,inputMode:"decimal",maximumFractionDigits:2})}),e.jsx(a.Field,{name:`earlyPayments[${n}].date`,children:a=>e.jsx(P,{header:r("earlyPaymentDate"),placeholder:r("earlyPaymentDate"),field:a,type:"date"})}),e.jsx(a.Field,{name:`earlyPayments[${n}].type`,children:a=>e.jsx(b,{header:r("earlyPaymentType"),field:a,options:[{label:r("typeReduceTerm"),value:"reduceTerm"},{label:r("typeReducePayment"),value:"reducePayment"}]})}),e.jsx(a.Subscribe,{selector:e=>[e.isFieldsValid,e.isValid],children:([a,t])=>e.jsx(o,{size:"s",mode:"outline",disabled:!a||!t,stretched:!0,onClick:()=>m.removeValue(n),children:r("remove")})})]},n))),e.jsx(a.Subscribe,{selector:e=>[e.isFieldsValid,e.isValid],children:([a,t])=>e.jsx(o,{disabled:!a||!t,stretched:!0,onClick:()=>m.pushValue({amount:"",date:(new Date).toISOString().split("T")[0],id:Date.now().toString(),type:"reduceTerm"}),children:r("addEarlyPayment")})})]})})]})})})}}),k=m.memo(w),B=C({...R,render:function({form:a}){const[t,n]=m.useState(!1),{t:r}=h();return e.jsx(l,{children:e.jsx(a.Field,{name:"regularPayments",mode:"array",children:m=>e.jsxs(i,{expanded:t,onChange:()=>n((e=>!e)),children:[e.jsxs(i.Summary,{children:[r("regularPayment"),Boolean(m.state.value.length)&&e.jsx(d,{large:!0,type:"dot",children:m.state.value.length})]}),e.jsx(i.Content,{style:{background:"transparent"},children:e.jsxs(l,{children:[m.state.value.map(((t,n)=>e.jsxs(s,{children:[e.jsx(a.Field,{name:`regularPayments[${n}].amount`,children:a=>e.jsx(v,{header:r("regularPaymentAmount"),placeholder:r("regularPaymentAmount"),field:a,inputMode:"decimal",maximumFractionDigits:2})}),e.jsx(a.Field,{name:`regularPayments[${n}].startMonth`,children:a=>e.jsx(P,{header:r("startMonth"),placeholder:r("startMonth"),field:a,type:"date"})}),e.jsx(a.Field,{name:`regularPayments[${n}].endMonth`,children:a=>e.jsx(P,{header:r("endMonth"),placeholder:r("endMonth"),field:a,type:"date"})}),e.jsx(a.Field,{name:`regularPayments[${n}].type`,children:a=>e.jsx(b,{header:r("earlyPaymentType"),field:a,options:[{label:r("typeReduceTerm"),value:"reduceTerm"},{label:r("typeReducePayment"),value:"reducePayment"}]})}),e.jsx(a.Subscribe,{selector:e=>[e.isFieldsValid,e.isValid],children:([a,t])=>e.jsx(o,{size:"s",mode:"outline",disabled:!a||!t,stretched:!0,onClick:()=>m.removeValue(n),children:r("remove")})})]},n))),e.jsx(a.Subscribe,{selector:e=>[e.isFieldsValid,e.isValid],children:([a,t])=>e.jsx(o,{disabled:!a||!t,stretched:!0,onClick:()=>m.pushValue({amount:"",startMonth:(new Date).toISOString().split("T")[0],endMonth:"",id:Date.now().toString(),type:"reduceTerm"}),children:r("addRegularPayment")})})]})})]})})})}}),$=m.memo(B),I=m.memo((()=>{const{t:a}=h(),t=V();return e.jsx(f,{back:!1,children:e.jsxs(s,{Component:"form",onSubmit:e=>{e.preventDefault(),e.stopPropagation(),t.handleSubmit()},children:[e.jsx(A,{form:t}),e.jsx(k,{form:t}),e.jsx($,{form:t}),e.jsx(l,{children:e.jsx(t.Subscribe,{selector:e=>[e.canSubmit,e.isSubmitting],children:([t,n])=>e.jsx(o,{type:"submit",stretched:!0,disabled:!t,loading:n,children:a("calculate")})})})]})})}));export{I as default};
//# sourceMappingURL=LoanForm-DLbfyrgr.js.map
